{"version":3,"file":"ColorInput.js","sources":["../../../../src/components/ColorPicker/ColorInput.tsx"],"sourcesContent":["import { cx, css } from '@emotion/css';\nimport { debounce } from 'lodash';\nimport React, { forwardRef, useState, useEffect, useMemo } from 'react';\nimport tinycolor from 'tinycolor2';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nimport { useStyles2 } from '../../themes';\nimport { Input, Props as InputProps } from '../Input/Input';\n\nimport { ColorPickerProps } from './ColorPickerPopover';\n\ninterface ColorInputProps extends ColorPickerProps, Omit<InputProps, 'color' | 'onChange'> {\n  isClearable?: boolean;\n}\n\nconst ColorInput = forwardRef<HTMLInputElement, ColorInputProps>(\n  ({ color, onChange, isClearable = false, ...inputProps }, ref) => {\n    const [value, setValue] = useState(color);\n    const [previousColor, setPreviousColor] = useState(color);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    const updateColor = useMemo(() => debounce(onChange, 100), []);\n\n    useEffect(() => {\n      const newColor = tinycolor(color);\n      if (newColor.isValid() && color !== previousColor) {\n        setValue(newColor.toString());\n        setPreviousColor(color);\n      }\n    }, [color, previousColor]);\n\n    const onChangeColor = (event: React.SyntheticEvent<HTMLInputElement>) => {\n      const { value: colorValue } = event.currentTarget;\n\n      setValue(colorValue);\n      if (colorValue === '' && isClearable) {\n        updateColor(colorValue);\n        return;\n      }\n      const newColor = tinycolor(colorValue);\n\n      if (newColor.isValid()) {\n        updateColor(newColor.toString());\n      }\n    };\n\n    const onBlur = () => {\n      const newColor = tinycolor(value);\n\n      if (!newColor.isValid()) {\n        setValue(color);\n      }\n    };\n\n    return (\n      <Input\n        {...inputProps}\n        value={value}\n        onChange={onChangeColor}\n        onBlur={onBlur}\n        addonBefore={<ColorPreview color={color} />}\n        ref={ref}\n      />\n    );\n  }\n);\n\nColorInput.displayName = 'ColorInput';\n\nexport default ColorInput;\n\ninterface ColorPreviewProps {\n  color: string;\n}\n\nconst ColorPreview = ({ color }: ColorPreviewProps) => {\n  const styles = useStyles2(getColorPreviewStyles);\n\n  return (\n    <div\n      className={cx(\n        styles,\n        css`\n          background-color: ${color};\n        `\n      )}\n    />\n  );\n};\n\nconst getColorPreviewStyles = (theme: GrafanaTheme2) => css`\n  height: 100%;\n  width: ${theme.spacing.gridSize * 4}px;\n  border-radius: ${theme.shape.borderRadius()} 0 0 ${theme.shape.borderRadius()};\n  border: 1px solid ${theme.colors.border.medium};\n`;\n"],"names":["React"],"mappings":"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"}