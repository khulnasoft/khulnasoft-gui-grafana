{"version":3,"file":"DataLinksInlineEditor.js","sources":["../../../../../src/components/DataLinks/DataLinksInlineEditor/DataLinksInlineEditor.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport { cloneDeep } from 'lodash';\nimport React, { useState } from 'react';\n\nimport { DataFrame, DataLink, GrafanaTheme2, VariableSuggestion } from '@grafana/data';\n\nimport { stylesFactory, useTheme2 } from '../../../themes';\nimport { Button } from '../../Button/Button';\nimport { Modal } from '../../Modal/Modal';\n\nimport { DataLinkEditorModalContent } from './DataLinkEditorModalContent';\nimport { DataLinksListItem } from './DataLinksListItem';\n\ninterface DataLinksInlineEditorProps {\n  links?: DataLink[];\n  onChange: (links: DataLink[]) => void;\n  getSuggestions: () => VariableSuggestion[];\n  data: DataFrame[];\n}\n\nexport const DataLinksInlineEditor: React.FC<DataLinksInlineEditorProps> = ({\n  links,\n  onChange,\n  getSuggestions,\n  data,\n}) => {\n  const theme = useTheme2();\n  const [editIndex, setEditIndex] = useState<number | null>(null);\n  const [isNew, setIsNew] = useState(false);\n\n  const styles = getDataLinksInlineEditorStyles(theme);\n  const linksSafe: DataLink[] = links ?? [];\n  const isEditing = editIndex !== null;\n\n  const onDataLinkChange = (index: number, link: DataLink) => {\n    if (isNew) {\n      if (link.title.trim() === '' && link.url.trim() === '') {\n        setIsNew(false);\n        setEditIndex(null);\n        return;\n      } else {\n        setEditIndex(null);\n        setIsNew(false);\n      }\n    }\n    const update = cloneDeep(linksSafe);\n    update[index] = link;\n    onChange(update);\n    setEditIndex(null);\n  };\n\n  const onDataLinkAdd = () => {\n    let update = cloneDeep(linksSafe);\n    setEditIndex(update.length);\n    setIsNew(true);\n  };\n\n  const onDataLinkCancel = (index: number) => {\n    if (isNew) {\n      setIsNew(false);\n    }\n    setEditIndex(null);\n  };\n\n  const onDataLinkRemove = (index: number) => {\n    const update = cloneDeep(linksSafe);\n    update.splice(index, 1);\n    onChange(update);\n  };\n\n  return (\n    <>\n      {linksSafe.length > 0 && (\n        <div className={styles.wrapper}>\n          {linksSafe.map((l, i) => {\n            return (\n              <DataLinksListItem\n                key={`${l.title}/${i}`}\n                index={i}\n                link={l}\n                onChange={onDataLinkChange}\n                onEdit={() => setEditIndex(i)}\n                onRemove={() => onDataLinkRemove(i)}\n                data={data}\n              />\n            );\n          })}\n        </div>\n      )}\n\n      {isEditing && editIndex !== null && (\n        <Modal\n          title=\"Edit link\"\n          isOpen={true}\n          closeOnBackdropClick={false}\n          onDismiss={() => {\n            onDataLinkCancel(editIndex);\n          }}\n        >\n          <DataLinkEditorModalContent\n            index={editIndex}\n            link={isNew ? { title: '', url: '' } : linksSafe[editIndex]}\n            data={data}\n            onSave={onDataLinkChange}\n            onCancel={onDataLinkCancel}\n            getSuggestions={getSuggestions}\n          />\n        </Modal>\n      )}\n\n      <Button size=\"sm\" icon=\"plus\" onClick={onDataLinkAdd} variant=\"secondary\">\n        Add link\n      </Button>\n    </>\n  );\n};\n\nconst getDataLinksInlineEditorStyles = stylesFactory((theme: GrafanaTheme2) => {\n  return {\n    wrapper: css`\n      margin-bottom: ${theme.spacing(2)};\n    `,\n  };\n});\n"],"names":["React"],"mappings":"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"}