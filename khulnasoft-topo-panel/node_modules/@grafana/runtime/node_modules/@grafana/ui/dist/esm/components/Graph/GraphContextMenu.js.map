{"version":3,"file":"GraphContextMenu.js","sources":["../../../../src/components/Graph/GraphContextMenu.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React from 'react';\n\nimport {\n  FlotDataPoint,\n  getValueFromDimension,\n  Dimensions,\n  dateTimeFormat,\n  TimeZone,\n  FormattedValue,\n  GrafanaTheme2,\n} from '@grafana/data';\n\nimport { useStyles2 } from '../../themes';\nimport { ContextMenu, ContextMenuProps } from '../ContextMenu/ContextMenu';\nimport { FormattedValueDisplay } from '../FormattedValueDisplay/FormattedValueDisplay';\nimport { HorizontalGroup } from '../Layout/Layout';\nimport { MenuGroup, MenuGroupProps } from '../Menu/MenuGroup';\nimport { MenuItem } from '../Menu/MenuItem';\nimport { SeriesIcon } from '../VizLegend/SeriesIcon';\n\nimport { GraphDimensions } from './GraphTooltip/types';\n\nexport type ContextDimensions<T extends Dimensions = any> = { [key in keyof T]: [number, number | undefined] | null };\n\nexport type GraphContextMenuProps = ContextMenuProps & {\n  getContextMenuSource: () => FlotDataPoint | null;\n  timeZone?: TimeZone;\n  itemsGroup?: MenuGroupProps[];\n  dimensions?: GraphDimensions;\n  contextDimensions?: ContextDimensions;\n};\n\n/** @internal */\nexport const GraphContextMenu: React.FC<GraphContextMenuProps> = ({\n  getContextMenuSource,\n  timeZone,\n  itemsGroup,\n  dimensions,\n  contextDimensions,\n  ...otherProps\n}) => {\n  const source = getContextMenuSource();\n\n  //  Do not render items that do not have label specified\n  const itemsToRender = itemsGroup\n    ? itemsGroup.map((group) => ({\n        ...group,\n        items: group.items?.filter((item) => item.label),\n      }))\n    : [];\n\n  const renderHeader = () => {\n    if (!source) {\n      return null;\n    }\n\n    // If dimensions supplied, we can calculate and display value\n    let value;\n    if (dimensions?.yAxis && contextDimensions?.yAxis?.[1]) {\n      const valueFromDimensions = getValueFromDimension(\n        dimensions.yAxis,\n        contextDimensions.yAxis[0],\n        contextDimensions.yAxis[1]\n      );\n      const display = source.series.valueField.display!;\n      value = display(valueFromDimensions);\n    }\n\n    const formattedValue = dateTimeFormat(source.datapoint[0], {\n      defaultWithMS: source.series.hasMsResolution,\n      timeZone,\n    });\n\n    return (\n      <GraphContextMenuHeader\n        timestamp={formattedValue}\n        seriesColor={source.series.color}\n        displayName={source.series.alias || source.series.label}\n        displayValue={value}\n      />\n    );\n  };\n  const renderMenuGroupItems = () => {\n    return itemsToRender?.map((group, index) => (\n      <MenuGroup key={`${group.label}${index}`} label={group.label}>\n        {(group.items || []).map((item) => (\n          <MenuItem\n            key={`${item.label}`}\n            url={item.url}\n            label={item.label}\n            target={item.target}\n            icon={item.icon}\n            active={item.active}\n            onClick={item.onClick}\n          />\n        ))}\n      </MenuGroup>\n    ));\n  };\n\n  return <ContextMenu {...otherProps} renderMenuItems={renderMenuGroupItems} renderHeader={renderHeader} />;\n};\n\n/** @internal */\nexport const GraphContextMenuHeader = ({\n  timestamp,\n  seriesColor,\n  displayName,\n  displayValue,\n}: {\n  timestamp: string;\n  seriesColor: string;\n  displayName: string;\n  displayValue: FormattedValue;\n}) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.wrapper}>\n      <strong>{timestamp}</strong>\n      <HorizontalGroup>\n        <div>\n          <SeriesIcon color={seriesColor} />\n          <span className={styles.displayName}>{displayName}</span>\n        </div>\n        {displayValue && <FormattedValueDisplay value={displayValue} />}\n      </HorizontalGroup>\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    wrapper: css`\n      padding: ${theme.spacing(0.5)} ${theme.spacing(1)};\n      font-size: ${theme.typography.size.sm};\n      z-index: ${theme.zIndex.tooltip};\n    `,\n    displayName: css`\n      white-space: nowrap;\n      padding-left: ${theme.spacing(0.5)};\n    `,\n  };\n}\n"],"names":["_a","React"],"mappings":"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"}