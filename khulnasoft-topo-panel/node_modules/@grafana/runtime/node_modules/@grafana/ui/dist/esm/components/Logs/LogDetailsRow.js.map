{"version":3,"file":"LogDetailsRow.js","sources":["../../../../src/components/Logs/LogDetailsRow.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { PureComponent } from 'react';\n\nimport { Field, LinkModel, LogLabelStatsModel, GrafanaTheme2 } from '@grafana/data';\n\nimport { withTheme2 } from '../../themes/index';\nimport { Themeable2 } from '../../types/theme';\nimport { ClipboardButton } from '../ClipboardButton/ClipboardButton';\nimport { DataLinkButton } from '../DataLinks/DataLinkButton';\nimport { IconButton } from '../IconButton/IconButton';\n\nimport { LogLabelStats } from './LogLabelStats';\nimport { getLogRowStyles } from './getLogRowStyles';\n\n/** @deprecated will be removed in the next major version */\nexport interface Props extends Themeable2 {\n  parsedValue: string;\n  parsedKey: string;\n  wrapLogMessage?: boolean;\n  isLabel?: boolean;\n  onClickFilterLabel?: (key: string, value: string) => void;\n  onClickFilterOutLabel?: (key: string, value: string) => void;\n  links?: Array<LinkModel<Field>>;\n  getStats: () => LogLabelStatsModel[] | null;\n  showDetectedFields?: string[];\n  onClickShowDetectedField?: (key: string) => void;\n  onClickHideDetectedField?: (key: string) => void;\n}\n\ninterface State {\n  showFieldsStats: boolean;\n  fieldCount: number;\n  fieldStats: LogLabelStatsModel[] | null;\n  mouseOver: boolean;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    noHoverBackground: css`\n      label: noHoverBackground;\n      :hover {\n        background-color: transparent;\n      }\n    `,\n    hoverCursor: css`\n      label: hoverCursor;\n      cursor: pointer;\n    `,\n    wordBreakAll: css`\n      label: wordBreakAll;\n      word-break: break-all;\n    `,\n    showingField: css`\n      color: ${theme.colors.primary.text};\n    `,\n    hoverValueCopy: css`\n      margin: ${theme.spacing(0, 0, 0, 1.2)};\n      position: absolute;\n      top: 0px;\n      justify-content: center;\n      border-radius: 20px;\n      width: 26px;\n      height: 26px;\n    `,\n    wrapLine: css`\n      label: wrapLine;\n      white-space: pre-wrap;\n    `,\n  };\n};\nclass UnThemedLogDetailsRow extends PureComponent<Props, State> {\n  state: State = {\n    showFieldsStats: false,\n    fieldCount: 0,\n    fieldStats: null,\n    mouseOver: false,\n  };\n\n  showField = () => {\n    const { onClickShowDetectedField, parsedKey } = this.props;\n    if (onClickShowDetectedField) {\n      onClickShowDetectedField(parsedKey);\n    }\n  };\n\n  hideField = () => {\n    const { onClickHideDetectedField, parsedKey } = this.props;\n    if (onClickHideDetectedField) {\n      onClickHideDetectedField(parsedKey);\n    }\n  };\n\n  filterLabel = () => {\n    const { onClickFilterLabel, parsedKey, parsedValue } = this.props;\n    if (onClickFilterLabel) {\n      onClickFilterLabel(parsedKey, parsedValue);\n    }\n  };\n\n  filterOutLabel = () => {\n    const { onClickFilterOutLabel, parsedKey, parsedValue } = this.props;\n    if (onClickFilterOutLabel) {\n      onClickFilterOutLabel(parsedKey, parsedValue);\n    }\n  };\n\n  showStats = () => {\n    const { showFieldsStats } = this.state;\n    if (!showFieldsStats) {\n      const fieldStats = this.props.getStats();\n      const fieldCount = fieldStats ? fieldStats.reduce((sum, stat) => sum + stat.count, 0) : 0;\n      this.setState({ fieldStats, fieldCount });\n    }\n    this.toggleFieldsStats();\n  };\n\n  toggleFieldsStats() {\n    this.setState((state) => {\n      return {\n        showFieldsStats: !state.showFieldsStats,\n      };\n    });\n  }\n\n  hoverValueCopy() {\n    const mouseOver = !this.state.mouseOver;\n    this.setState({ mouseOver });\n  }\n\n  render() {\n    const {\n      theme,\n      parsedKey,\n      parsedValue,\n      isLabel,\n      links,\n      showDetectedFields,\n      wrapLogMessage,\n      onClickShowDetectedField,\n      onClickHideDetectedField,\n      onClickFilterLabel,\n      onClickFilterOutLabel,\n    } = this.props;\n    const { showFieldsStats, fieldStats, fieldCount, mouseOver } = this.state;\n    const styles = getStyles(theme);\n    const style = getLogRowStyles(theme);\n\n    const hasDetectedFieldsFunctionality = onClickShowDetectedField && onClickHideDetectedField;\n    const hasFilteringFunctionality = onClickFilterLabel && onClickFilterOutLabel;\n\n    const toggleFieldButton =\n      !isLabel && showDetectedFields && showDetectedFields.includes(parsedKey) ? (\n        <IconButton name=\"eye\" className={styles.showingField} title=\"Hide this field\" onClick={this.hideField} />\n      ) : (\n        <IconButton name=\"eye\" title=\"Show this field instead of the message\" onClick={this.showField} />\n      );\n\n    return (\n      <tr className={cx(style.logDetailsValue, { [styles.noHoverBackground]: showFieldsStats })}>\n        {/* Action buttons - show stats/filter results */}\n        <td className={style.logsDetailsIcon}>\n          <IconButton name=\"signal\" title={'Ad-hoc statistics'} onClick={this.showStats} />\n        </td>\n\n        {hasFilteringFunctionality && isLabel && (\n          <>\n            <td className={style.logsDetailsIcon}>\n              <IconButton name=\"search-plus\" title=\"Filter for value\" onClick={this.filterLabel} />\n            </td>\n            <td className={style.logsDetailsIcon}>\n              <IconButton name=\"search-minus\" title=\"Filter out value\" onClick={this.filterOutLabel} />\n            </td>\n          </>\n        )}\n\n        {hasDetectedFieldsFunctionality && !isLabel && (\n          <td className={style.logsDetailsIcon} colSpan={2}>\n            {toggleFieldButton}\n          </td>\n        )}\n\n        {/* Key - value columns */}\n        <td className={style.logDetailsLabel}>{parsedKey}</td>\n        <td\n          className={cx(styles.wordBreakAll, wrapLogMessage && styles.wrapLine)}\n          onMouseEnter={this.hoverValueCopy.bind(this)}\n          onMouseLeave={this.hoverValueCopy.bind(this)}\n        >\n          {parsedValue}\n          {mouseOver && (\n            <ClipboardButton\n              getText={() => parsedValue}\n              title=\"Copy value to clipboard\"\n              fill=\"text\"\n              variant=\"secondary\"\n              icon=\"copy\"\n              size=\"sm\"\n              className={styles.hoverValueCopy}\n            />\n          )}\n          {links?.map((link) => (\n            <span key={link.title}>\n              &nbsp;\n              <DataLinkButton link={link} />\n            </span>\n          ))}\n          {showFieldsStats && (\n            <LogLabelStats\n              stats={fieldStats!}\n              label={parsedKey}\n              value={parsedValue}\n              rowCount={fieldCount}\n              isLabel={isLabel}\n            />\n          )}\n        </td>\n      </tr>\n    );\n  }\n}\n\n/** @deprecated will be removed in the next major version */\nexport const LogDetailsRow = withTheme2(UnThemedLogDetailsRow);\nLogDetailsRow.displayName = 'LogDetailsRow';\n"],"names":["React"],"mappings":"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"}