{"version":3,"file":"SegmentAsync.js","sources":["../../../../src/components/Segment/SegmentAsync.tsx"],"sourcesContent":["import { cx } from '@emotion/css';\nimport { isObject } from 'lodash';\nimport React, { HTMLProps } from 'react';\nimport { useAsyncFn } from 'react-use';\nimport { AsyncState } from 'react-use/lib/useAsync';\n\nimport { SelectableValue } from '@grafana/data';\n\nimport { useStyles2 } from '../../themes';\nimport { InlineLabel } from '../Forms/InlineLabel';\n\nimport { SegmentSelect } from './SegmentSelect';\nimport { getSegmentStyles } from './styles';\n\nimport { useExpandableLabel, SegmentProps } from '.';\n\nexport interface SegmentAsyncProps<T> extends SegmentProps<T>, Omit<HTMLProps<HTMLDivElement>, 'value' | 'onChange'> {\n  value?: T | SelectableValue<T>;\n  loadOptions: (query?: string) => Promise<Array<SelectableValue<T>>>;\n  /**\n   *  If true options will be reloaded when user changes the value in the input,\n   *  otherwise, options will be loaded when the segment is clicked\n   */\n  reloadOptionsOnChange?: boolean;\n  onChange: (item: SelectableValue<T>) => void;\n  noOptionMessageHandler?: (state: AsyncState<Array<SelectableValue<T>>>) => string;\n  inputMinWidth?: number;\n}\n\nexport function SegmentAsync<T>({\n  value,\n  onChange,\n  loadOptions,\n  reloadOptionsOnChange = false,\n  Component,\n  className,\n  allowCustomValue,\n  allowEmptyValue,\n  disabled,\n  placeholder,\n  inputMinWidth,\n  inputPlaceholder,\n  autofocus = false,\n  onExpandedChange,\n  noOptionMessageHandler = mapStateToNoOptionsMessage,\n  ...rest\n}: React.PropsWithChildren<SegmentAsyncProps<T>>) {\n  const [state, fetchOptions] = useAsyncFn(loadOptions, [loadOptions]);\n  const [Label, labelWidth, expanded, setExpanded] = useExpandableLabel(autofocus, onExpandedChange);\n  const width = inputMinWidth ? Math.max(inputMinWidth, labelWidth) : labelWidth;\n  const styles = useStyles2(getSegmentStyles);\n\n  if (!expanded) {\n    const label = isObject(value) ? value.label : value;\n\n    return (\n      <Label\n        onClick={reloadOptionsOnChange ? undefined : fetchOptions}\n        disabled={disabled}\n        Component={\n          Component || (\n            <InlineLabel\n              className={cx(\n                styles.segment,\n                {\n                  [styles.queryPlaceholder]: placeholder !== undefined && !value,\n                  [styles.disabled]: disabled,\n                },\n                className\n              )}\n            >\n              {label || placeholder}\n            </InlineLabel>\n          )\n        }\n      />\n    );\n  }\n\n  return (\n    <SegmentSelect\n      {...rest}\n      value={value && !isObject(value) ? { value } : value}\n      placeholder={inputPlaceholder}\n      options={state.value ?? []}\n      loadOptions={reloadOptionsOnChange ? fetchOptions : undefined}\n      width={width}\n      noOptionsMessage={noOptionMessageHandler(state)}\n      allowCustomValue={allowCustomValue}\n      allowEmptyValue={allowEmptyValue}\n      onClickOutside={() => {\n        setExpanded(false);\n      }}\n      onChange={(item) => {\n        setExpanded(false);\n        onChange(item);\n      }}\n    />\n  );\n}\n\nfunction mapStateToNoOptionsMessage<T>(state: AsyncState<Array<SelectableValue<T>>>): string {\n  if (state.loading) {\n    return 'Loading options...';\n  }\n\n  if (state.error) {\n    return 'Failed to load options';\n  }\n\n  if (!Array.isArray(state.value) || state.value.length === 0) {\n    return 'No options found';\n  }\n\n  return '';\n}\n"],"names":["_a","React"],"mappings":"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"}