{"version":3,"file":"SelectMenu.js","sources":["../../../../src/components/Select/SelectMenu.tsx"],"sourcesContent":["import { cx } from '@emotion/css';\nimport { max } from 'lodash';\nimport React, { RefCallback } from 'react';\nimport { MenuListProps } from 'react-select';\nimport { FixedSizeList as List } from 'react-window';\n\nimport { SelectableValue, toIconName } from '@grafana/data';\n\nimport { useTheme2 } from '../../themes/ThemeContext';\nimport { CustomScrollbar } from '../CustomScrollbar/CustomScrollbar';\nimport { Icon } from '../Icon/Icon';\n\nimport { getSelectStyles } from './getSelectStyles';\n\ninterface SelectMenuProps {\n  maxHeight: number;\n  innerRef: RefCallback<HTMLDivElement>;\n  innerProps: {};\n}\n\nexport const SelectMenu = ({ children, maxHeight, innerRef, innerProps }: React.PropsWithChildren<SelectMenuProps>) => {\n  const theme = useTheme2();\n  const styles = getSelectStyles(theme);\n\n  return (\n    <div {...innerProps} className={styles.menu} style={{ maxHeight }} aria-label=\"Select options menu\">\n      <CustomScrollbar scrollRefCallback={innerRef} autoHide={false} autoHeightMax=\"inherit\" hideHorizontalTrack>\n        {children}\n      </CustomScrollbar>\n    </div>\n  );\n};\n\nSelectMenu.displayName = 'SelectMenu';\n\nconst VIRTUAL_LIST_ITEM_HEIGHT = 37;\nconst VIRTUAL_LIST_WIDTH_ESTIMATE_MULTIPLIER = 7;\n\n// A virtualized version of the SelectMenu, descriptions for SelectableValue options not supported since those are of a variable height.\n//\n// To support the virtualized list we have to \"guess\" the width of the menu container based on the longest available option.\n// the reason for this is because all of the options will be positioned absolute, this takes them out of the document and no space\n// is created for them, thus the container can't grow to accomodate.\n//\n// VIRTUAL_LIST_ITEM_HEIGHT and WIDTH_ESTIMATE_MULTIPLIER are both magic numbers.\n// Some characters (such as emojis and other unicode characters) may consist of multiple code points in which case the width would be inaccurate (but larger than needed).\nexport const VirtualizedSelectMenu = ({ children, maxHeight, options, getValue }: MenuListProps<SelectableValue>) => {\n  const theme = useTheme2();\n  const styles = getSelectStyles(theme);\n  const [value] = getValue();\n\n  const valueIndex = value ? options.findIndex((option: SelectableValue<unknown>) => option.value === value.value) : 0;\n  const initialOffset = valueIndex * VIRTUAL_LIST_ITEM_HEIGHT;\n\n  if (!Array.isArray(children)) {\n    return null;\n  }\n\n  const longestOption = max(options.map((option) => option.label?.length)) ?? 0;\n  const widthEstimate = longestOption * VIRTUAL_LIST_WIDTH_ESTIMATE_MULTIPLIER;\n  const heightEstimate = Math.min(options.length * VIRTUAL_LIST_ITEM_HEIGHT, maxHeight);\n\n  return (\n    <List\n      className={styles.menu}\n      height={heightEstimate}\n      width={widthEstimate}\n      aria-label=\"Select options menu\"\n      itemCount={children.length}\n      itemSize={VIRTUAL_LIST_ITEM_HEIGHT}\n      initialScrollOffset={initialOffset}\n    >\n      {({ index, style }) => <div style={{ ...style, overflow: 'hidden' }}>{children[index]}</div>}\n    </List>\n  );\n};\n\nVirtualizedSelectMenu.displayName = 'VirtualizedSelectMenu';\n\ninterface SelectMenuOptionProps<T> {\n  isDisabled: boolean;\n  isFocused: boolean;\n  isSelected: boolean;\n  innerProps: JSX.IntrinsicElements['div'];\n  innerRef: RefCallback<HTMLDivElement>;\n  renderOptionLabel?: (value: SelectableValue<T>) => JSX.Element;\n  data: SelectableValue<T>;\n}\n\nexport const SelectMenuOptions = ({\n  children,\n  data,\n  innerProps,\n  innerRef,\n  isFocused,\n  isSelected,\n  renderOptionLabel,\n}: React.PropsWithChildren<SelectMenuOptionProps<any>>) => {\n  const theme = useTheme2();\n  const styles = getSelectStyles(theme);\n  const icon = data.icon ? toIconName(data.icon) : undefined;\n\n  return (\n    <div\n      ref={innerRef}\n      className={cx(\n        styles.option,\n        isFocused && styles.optionFocused,\n        isSelected && styles.optionSelected,\n        data.isDisabled && styles.optionDisabled\n      )}\n      {...innerProps}\n      aria-label=\"Select option\"\n      title={data.title}\n    >\n      {icon && <Icon name={icon} className={styles.optionIcon} />}\n      {data.imgUrl && <img className={styles.optionImage} src={data.imgUrl} alt={data.label || data.value} />}\n      <div className={styles.optionBody}>\n        <span>{renderOptionLabel ? renderOptionLabel(data) : children}</span>\n        {data.description && <div className={styles.optionDescription}>{data.description}</div>}\n        {data.component && <data.component />}\n      </div>\n    </div>\n  );\n};\n\nSelectMenuOptions.displayName = 'SelectMenuOptions';\n"],"names":["React","_a","List"],"mappings":"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"}