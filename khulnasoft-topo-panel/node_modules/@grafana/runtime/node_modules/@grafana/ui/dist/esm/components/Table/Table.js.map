{"version":3,"file":"Table.js","sources":["../../../../src/components/Table/Table.tsx"],"sourcesContent":["import React, { CSSProperties, memo, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport {\n  Cell,\n  TableState,\n  useAbsoluteLayout,\n  useFilters,\n  usePagination,\n  useResizeColumns,\n  useSortBy,\n  useTable,\n} from 'react-table';\nimport usePrevious from 'react-use/lib/usePrevious';\nimport { VariableSizeList } from 'react-window';\n\nimport { DataFrame, getFieldDisplayName, Field } from '@grafana/data';\n\nimport { useStyles2, useTheme2 } from '../../themes';\nimport { CustomScrollbar } from '../CustomScrollbar/CustomScrollbar';\nimport { Pagination } from '../Pagination/Pagination';\n\nimport { FooterRow } from './FooterRow';\nimport { HeaderRow } from './HeaderRow';\nimport { TableCell } from './TableCell';\nimport { getTableStyles } from './styles';\nimport {\n  TableColumnResizeActionCallback,\n  TableFilterActionCallback,\n  FooterItem,\n  TableSortByActionCallback,\n  TableSortByFieldState,\n  TableFooterCalc,\n  GrafanaTableColumn,\n} from './types';\nimport {\n  getColumns,\n  sortCaseInsensitive,\n  sortNumber,\n  getFooterItems,\n  createFooterCalculationValues,\n  EXPANDER_WIDTH,\n} from './utils';\n\nconst COLUMN_MIN_WIDTH = 150;\n\nexport interface Props {\n  ariaLabel?: string;\n  data: DataFrame;\n  width: number;\n  height: number;\n  /** Minimal column width specified in pixels */\n  columnMinWidth?: number;\n  noHeader?: boolean;\n  showTypeIcons?: boolean;\n  resizable?: boolean;\n  initialSortBy?: TableSortByFieldState[];\n  onColumnResize?: TableColumnResizeActionCallback;\n  onSortByChange?: TableSortByActionCallback;\n  onCellFilterAdded?: TableFilterActionCallback;\n  footerOptions?: TableFooterCalc;\n  footerValues?: FooterItem[];\n  enablePagination?: boolean;\n  /** @alpha */\n  subData?: DataFrame[];\n}\n\nfunction useTableStateReducer({ onColumnResize, onSortByChange, data }: Props) {\n  return useCallback(\n    (newState: TableState, action: { type: string }) => {\n      switch (action.type) {\n        case 'columnDoneResizing':\n          if (onColumnResize) {\n            const info = (newState.columnResizing.headerIdWidths as any)[0];\n            const columnIdString = info[0];\n            const fieldIndex = parseInt(columnIdString, 10);\n            const width = Math.round(newState.columnResizing.columnWidths[columnIdString] as number);\n\n            const field = data.fields[fieldIndex];\n            if (!field) {\n              return newState;\n            }\n\n            const fieldDisplayName = getFieldDisplayName(field, data);\n            onColumnResize(fieldDisplayName, width);\n          }\n        case 'toggleSortBy':\n          if (onSortByChange) {\n            const sortByFields: TableSortByFieldState[] = [];\n\n            for (const sortItem of newState.sortBy) {\n              const field = data.fields[parseInt(sortItem.id, 10)];\n              if (!field) {\n                continue;\n              }\n\n              sortByFields.push({\n                displayName: getFieldDisplayName(field, data),\n                desc: sortItem.desc,\n              });\n            }\n\n            onSortByChange(sortByFields);\n          }\n          break;\n      }\n\n      return newState;\n    },\n    [data, onColumnResize, onSortByChange]\n  );\n}\n\nfunction getInitialState(initialSortBy: Props['initialSortBy'], columns: GrafanaTableColumn[]): Partial<TableState> {\n  const state: Partial<TableState> = {};\n\n  if (initialSortBy) {\n    state.sortBy = [];\n\n    for (const sortBy of initialSortBy) {\n      for (const col of columns) {\n        if (col.Header === sortBy.displayName) {\n          state.sortBy.push({ id: col.id!, desc: sortBy.desc });\n        }\n      }\n    }\n  }\n\n  return state;\n}\n\nexport const Table = memo((props: Props) => {\n  const {\n    ariaLabel,\n    data,\n    subData,\n    height,\n    onCellFilterAdded,\n    width,\n    columnMinWidth = COLUMN_MIN_WIDTH,\n    noHeader,\n    resizable = true,\n    initialSortBy,\n    footerOptions,\n    showTypeIcons,\n    footerValues,\n    enablePagination,\n  } = props;\n\n  const listRef = useRef<VariableSizeList>(null);\n  const tableDivRef = useRef<HTMLDivElement>(null);\n  const variableSizeListScrollbarRef = useRef<HTMLDivElement>(null);\n  const tableStyles = useStyles2(getTableStyles);\n  const theme = useTheme2();\n  const headerHeight = noHeader ? 0 : tableStyles.cellHeight;\n  const [footerItems, setFooterItems] = useState<FooterItem[] | undefined>(footerValues);\n  const [expandedIndexes, setExpandedIndexes] = useState<Set<number>>(new Set());\n  const prevExpandedIndexes = usePrevious(expandedIndexes);\n\n  const footerHeight = useMemo(() => {\n    const EXTENDED_ROW_HEIGHT = 33;\n    let length = 0;\n\n    if (!footerItems) {\n      return 0;\n    }\n\n    for (const fv of footerItems) {\n      if (Array.isArray(fv) && fv.length > length) {\n        length = fv.length;\n      }\n    }\n\n    if (length > 1) {\n      return EXTENDED_ROW_HEIGHT * length;\n    }\n\n    return EXTENDED_ROW_HEIGHT;\n  }, [footerItems]);\n\n  // React table data array. This data acts just like a dummy array to let react-table know how many rows exist\n  // The cells use the field to look up values\n  const memoizedData = useMemo(() => {\n    if (!data.fields.length) {\n      return [];\n    }\n    // as we only use this to fake the length of our data set for react-table we need to make sure we always return an array\n    // filled with values at each index otherwise we'll end up trying to call accessRow for null|undefined value in\n    // https://github.com/tannerlinsley/react-table/blob/7be2fc9d8b5e223fc998af88865ae86a88792fdb/src/hooks/useTable.js#L585\n    return Array(data.length).fill(0);\n  }, [data]);\n\n  // React-table column definitions\n  const memoizedColumns = useMemo(\n    () => getColumns(data, width, columnMinWidth, expandedIndexes, setExpandedIndexes, !!subData?.length, footerItems),\n    [data, width, columnMinWidth, footerItems, subData, expandedIndexes]\n  );\n\n  // Internal react table state reducer\n  const stateReducer = useTableStateReducer(props);\n\n  const options: any = useMemo(\n    () => ({\n      columns: memoizedColumns,\n      data: memoizedData,\n      disableResizing: !resizable,\n      stateReducer: stateReducer,\n      initialState: getInitialState(initialSortBy, memoizedColumns),\n      autoResetFilters: false,\n      sortTypes: {\n        number: sortNumber, // the builtin number type on react-table does not handle NaN values\n        'alphanumeric-insensitive': sortCaseInsensitive, // should be replace with the builtin string when react-table is upgraded, see https://github.com/tannerlinsley/react-table/pull/3235\n      },\n    }),\n    [initialSortBy, memoizedColumns, memoizedData, resizable, stateReducer]\n  );\n\n  const {\n    getTableProps,\n    headerGroups,\n    rows,\n    prepareRow,\n    totalColumnsWidth,\n    footerGroups,\n    page,\n    state,\n    gotoPage,\n    setPageSize,\n    pageOptions,\n  } = useTable(options, useFilters, useSortBy, usePagination, useAbsoluteLayout, useResizeColumns);\n\n  /*\n    Footer value calculation is being moved in the Table component and the footerValues prop will be deprecated.\n    The footerValues prop is still used in the Table component for backwards compatibility. Adding the\n    footerOptions prop will switch the Table component to use the new footer calculation. Using both props will\n    result in the footerValues prop being ignored.\n  */\n  useEffect(() => {\n    if (!footerOptions) {\n      setFooterItems(footerValues);\n    }\n  }, [footerValues, footerOptions]);\n\n  useEffect(() => {\n    if (!footerOptions) {\n      return;\n    }\n\n    if (footerOptions.show) {\n      setFooterItems(\n        getFooterItems(\n          headerGroups[0].headers as unknown as Array<{ field: Field }>,\n          createFooterCalculationValues(rows),\n          footerOptions,\n          theme\n        )\n      );\n    } else {\n      setFooterItems(undefined);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [footerOptions, theme, state.filters, data]);\n\n  let listHeight = height - (headerHeight + footerHeight);\n\n  if (enablePagination) {\n    listHeight -= tableStyles.cellHeight;\n  }\n  const pageSize = Math.round(listHeight / tableStyles.cellHeight) - 1;\n  useEffect(() => {\n    // Don't update the page size if it is less than 1\n    if (pageSize <= 0) {\n      return;\n    }\n    setPageSize(pageSize);\n  }, [pageSize, setPageSize]);\n\n  useEffect(() => {\n    // react-table caches the height of cells so we need to reset them when expanding/collapsing rows\n    // We need to take the minimum of the current expanded indexes and the previous expandedIndexes array to account\n    // for collapsed rows, since they disappear from expandedIndexes but still keep their expanded height\n    listRef.current?.resetAfterIndex(\n      Math.min(...Array.from(expandedIndexes), ...(prevExpandedIndexes ? Array.from(prevExpandedIndexes) : []))\n    );\n  }, [expandedIndexes, prevExpandedIndexes]);\n\n  useEffect(() => {\n    // To have the custom vertical scrollbar always visible (https://github.com/grafana/grafana/issues/52136),\n    // we need to bring the element from the VariableSizeList scope to the outer Table container scope,\n    // because the VariableSizeList scope has overflow. By moving scrollbar to container scope we will have\n    // it always visible since the entire width is in view.\n\n    // Select the scrollbar element from the VariableSizeList scope\n    const listVerticalScrollbarHTML = (variableSizeListScrollbarRef.current as HTMLDivElement)?.querySelector(\n      '.track-vertical'\n    );\n\n    // Select Table custom scrollbars\n    const tableScrollbarView = (tableDivRef.current as HTMLDivElement)?.firstChild;\n\n    //If they exists, move the scrollbar element to the Table container scope\n    if (tableScrollbarView && listVerticalScrollbarHTML) {\n      listVerticalScrollbarHTML?.remove();\n      (tableScrollbarView as HTMLDivElement).querySelector(':scope > .track-vertical')?.remove();\n\n      (tableScrollbarView as HTMLDivElement).append(listVerticalScrollbarHTML as Node);\n    }\n  });\n\n  useEffect(() => {\n    setExpandedIndexes(new Set());\n  }, [data, subData]);\n\n  const renderSubTable = React.useCallback(\n    (rowIndex: number) => {\n      if (expandedIndexes.has(rowIndex)) {\n        const rowSubData = subData?.find((frame) => frame.meta?.custom?.parentRowIndex === rowIndex);\n        if (rowSubData) {\n          const noHeader = !!rowSubData.meta?.custom?.noHeader;\n          const subTableStyle: CSSProperties = {\n            height: tableStyles.rowHeight * (rowSubData.length + (noHeader ? 0 : 1)), // account for the header with + 1\n            background: theme.colors.emphasize(theme.colors.background.primary, 0.015),\n            paddingLeft: EXPANDER_WIDTH,\n            position: 'absolute',\n            bottom: 0,\n          };\n          return (\n            <div style={subTableStyle}>\n              <Table\n                data={rowSubData}\n                width={width - EXPANDER_WIDTH}\n                height={tableStyles.rowHeight * (rowSubData.length + 1)}\n                noHeader={noHeader}\n              />\n            </div>\n          );\n        }\n      }\n      return null;\n    },\n    [expandedIndexes, subData, tableStyles.rowHeight, theme.colors, width]\n  );\n\n  const RenderRow = React.useCallback(\n    ({ index: rowIndex, style }: { index: number; style: CSSProperties }) => {\n      let row = rows[rowIndex];\n      if (enablePagination) {\n        row = page[rowIndex];\n      }\n      prepareRow(row);\n\n      return (\n        <div {...row.getRowProps({ style })} className={tableStyles.row}>\n          {/*add the subtable to the DOM first to prevent a 1px border CSS issue on the last cell of the row*/}\n          {renderSubTable(rowIndex)}\n          {row.cells.map((cell: Cell, index: number) => (\n            <TableCell\n              key={index}\n              tableStyles={tableStyles}\n              cell={cell}\n              onCellFilterAdded={onCellFilterAdded}\n              columnIndex={index}\n              columnCount={row.cells.length}\n            />\n          ))}\n        </div>\n      );\n    },\n    [onCellFilterAdded, page, enablePagination, prepareRow, rows, tableStyles, renderSubTable]\n  );\n\n  const onNavigate = useCallback(\n    (toPage: number) => {\n      gotoPage(toPage - 1);\n    },\n    [gotoPage]\n  );\n\n  const itemCount = enablePagination ? page.length : rows.length;\n  let paginationEl = null;\n  if (enablePagination) {\n    const itemsRangeStart = state.pageIndex * state.pageSize + 1;\n    let itemsRangeEnd = itemsRangeStart + state.pageSize - 1;\n    const isSmall = width < 550;\n    if (itemsRangeEnd > data.length) {\n      itemsRangeEnd = data.length;\n    }\n    paginationEl = (\n      <div className={tableStyles.paginationWrapper}>\n        {isSmall ? null : <div className={tableStyles.paginationItem} />}\n        <div className={tableStyles.paginationCenterItem}>\n          <Pagination\n            currentPage={state.pageIndex + 1}\n            numberOfPages={pageOptions.length}\n            showSmallVersion={isSmall}\n            onNavigate={onNavigate}\n          />\n        </div>\n        {isSmall ? null : (\n          <div className={tableStyles.paginationSummary}>\n            {itemsRangeStart} - {itemsRangeEnd} of {data.length} rows\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  const getItemSize = (index: number): number => {\n    if (expandedIndexes.has(index)) {\n      const rowSubData = subData?.find((frame) => frame.meta?.custom?.parentRowIndex === index);\n      if (rowSubData) {\n        const noHeader = !!rowSubData.meta?.custom?.noHeader;\n        return tableStyles.rowHeight * (rowSubData.length + 1 + (noHeader ? 0 : 1)); // account for the header and the row data with + 1 + 1\n      }\n    }\n    return tableStyles.rowHeight;\n  };\n\n  const handleScroll: React.UIEventHandler = (event) => {\n    const { scrollTop } = event.target as HTMLDivElement;\n\n    if (listRef.current !== null) {\n      listRef.current.scrollTo(scrollTop);\n    }\n  };\n\n  return (\n    <div {...getTableProps()} className={tableStyles.table} aria-label={ariaLabel} role=\"table\" ref={tableDivRef}>\n      <CustomScrollbar hideVerticalTrack={true}>\n        <div className={tableStyles.tableContentWrapper(totalColumnsWidth)}>\n          {!noHeader && <HeaderRow headerGroups={headerGroups} showTypeIcons={showTypeIcons} />}\n          {itemCount > 0 ? (\n            <div ref={variableSizeListScrollbarRef}>\n              <CustomScrollbar onScroll={handleScroll} hideHorizontalTrack={true}>\n                <VariableSizeList\n                  height={listHeight}\n                  itemCount={itemCount}\n                  itemSize={getItemSize}\n                  width={'100%'}\n                  ref={listRef}\n                  style={{ overflow: undefined }}\n                >\n                  {RenderRow}\n                </VariableSizeList>\n              </CustomScrollbar>\n            </div>\n          ) : (\n            <div style={{ height: height - headerHeight }} className={tableStyles.noData}>\n              No data\n            </div>\n          )}\n          {footerItems && (\n            <FooterRow\n              height={footerHeight}\n              isPaginationVisible={Boolean(enablePagination)}\n              footerValues={footerItems}\n              footerGroups={footerGroups}\n              totalColumnsWidth={totalColumnsWidth}\n            />\n          )}\n        </div>\n      </CustomScrollbar>\n      {paginationEl}\n    </div>\n  );\n});\n\nTable.displayName = 'Table';\n"],"names":["React","_a","_b","noHeader"],"mappings":"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"}