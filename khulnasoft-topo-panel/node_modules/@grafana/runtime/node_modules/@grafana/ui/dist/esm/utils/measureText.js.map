{"version":3,"file":"measureText.js","sources":["../../../src/utils/measureText.ts"],"sourcesContent":["let _context: CanvasRenderingContext2D;\nconst cache = new Map<string, TextMetrics>();\nconst cacheLimit = 500;\nlet ctxFontStyle = '';\n\n/**\n * @internal\n */\nexport function getCanvasContext() {\n  if (!_context) {\n    _context = document.createElement('canvas').getContext('2d')!;\n  }\n  return _context;\n}\n\n/**\n * @beta\n */\nexport function measureText(text: string, fontSize: number): TextMetrics {\n  const fontStyle = `${fontSize}px 'Roboto'`;\n  const cacheKey = text + fontStyle;\n  const fromCache = cache.get(cacheKey);\n\n  if (fromCache) {\n    return fromCache;\n  }\n\n  const context = getCanvasContext();\n\n  if (ctxFontStyle !== fontStyle) {\n    context.font = ctxFontStyle = fontStyle;\n  }\n\n  const metrics = context.measureText(text);\n\n  if (cache.size === cacheLimit) {\n    cache.clear();\n  }\n\n  cache.set(cacheKey, metrics);\n\n  return metrics;\n}\n\n/**\n * @beta\n */\nexport function calculateFontSize(text: string, width: number, height: number, lineHeight: number, maxSize?: number) {\n  // calculate width in 14px\n  const textSize = measureText(text, 14);\n  // how much bigger than 14px can we make it while staying within our width constraints\n  const fontSizeBasedOnWidth = (width / (textSize.width + 2)) * 14;\n  const fontSizeBasedOnHeight = height / lineHeight;\n\n  // final fontSize\n  const optimalSize = Math.min(fontSizeBasedOnHeight, fontSizeBasedOnWidth);\n  return Math.min(optimalSize, maxSize ?? optimalSize);\n}\n"],"names":[],"mappings":"AAAA,IAAI,QAAA,CAAA;AACJ,MAAM,KAAA,uBAAY,GAAyB,EAAA,CAAA;AAC3C,MAAM,UAAa,GAAA,GAAA,CAAA;AACnB,IAAI,YAAe,GAAA,EAAA,CAAA;AAKZ,SAAS,gBAAmB,GAAA;AACjC,EAAA,IAAI,CAAC,QAAU,EAAA;AACb,IAAA,QAAA,GAAW,QAAS,CAAA,aAAA,CAAc,QAAQ,CAAA,CAAE,WAAW,IAAI,CAAA,CAAA;AAAA,GAC7D;AACA,EAAO,OAAA,QAAA,CAAA;AACT,CAAA;AAKgB,SAAA,WAAA,CAAY,MAAc,QAA+B,EAAA;AACvE,EAAA,MAAM,YAAY,CAAG,EAAA,QAAA,CAAA,WAAA,CAAA,CAAA;AACrB,EAAA,MAAM,WAAW,IAAO,GAAA,SAAA,CAAA;AACxB,EAAM,MAAA,SAAA,GAAY,KAAM,CAAA,GAAA,CAAI,QAAQ,CAAA,CAAA;AAEpC,EAAA,IAAI,SAAW,EAAA;AACb,IAAO,OAAA,SAAA,CAAA;AAAA,GACT;AAEA,EAAA,MAAM,UAAU,gBAAiB,EAAA,CAAA;AAEjC,EAAA,IAAI,iBAAiB,SAAW,EAAA;AAC9B,IAAA,OAAA,CAAQ,OAAO,YAAe,GAAA,SAAA,CAAA;AAAA,GAChC;AAEA,EAAM,MAAA,OAAA,GAAU,OAAQ,CAAA,WAAA,CAAY,IAAI,CAAA,CAAA;AAExC,EAAI,IAAA,KAAA,CAAM,SAAS,UAAY,EAAA;AAC7B,IAAA,KAAA,CAAM,KAAM,EAAA,CAAA;AAAA,GACd;AAEA,EAAM,KAAA,CAAA,GAAA,CAAI,UAAU,OAAO,CAAA,CAAA;AAE3B,EAAO,OAAA,OAAA,CAAA;AACT,CAAA;AAKO,SAAS,iBAAkB,CAAA,IAAA,EAAc,KAAe,EAAA,MAAA,EAAgB,YAAoB,OAAkB,EAAA;AAEnH,EAAM,MAAA,QAAA,GAAW,WAAY,CAAA,IAAA,EAAM,EAAE,CAAA,CAAA;AAErC,EAAA,MAAM,oBAAwB,GAAA,KAAA,IAAS,QAAS,CAAA,KAAA,GAAQ,CAAM,CAAA,GAAA,EAAA,CAAA;AAC9D,EAAA,MAAM,wBAAwB,MAAS,GAAA,UAAA,CAAA;AAGvC,EAAA,MAAM,WAAc,GAAA,IAAA,CAAK,GAAI,CAAA,qBAAA,EAAuB,oBAAoB,CAAA,CAAA;AACxE,EAAA,OAAO,IAAK,CAAA,GAAA,CAAI,WAAa,EAAA,OAAA,IAAA,IAAA,GAAA,OAAA,GAAW,WAAW,CAAA,CAAA;AACrD;;;;"}