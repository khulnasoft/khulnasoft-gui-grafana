{"version":3,"file":"DefaultCell.js","sources":["../../../../src/components/Table/DefaultCell.tsx"],"sourcesContent":["import { cx } from '@emotion/css';\nimport React, { ReactElement, useState } from 'react';\nimport tinycolor from 'tinycolor2';\n\nimport { DisplayValue, formattedValueToString } from '@grafana/data';\nimport { TableCellBackgroundDisplayMode, TableCellDisplayMode } from '@grafana/schema';\n\nimport { useStyles2 } from '../../themes';\nimport { getCellLinks, getTextColorForAlphaBackground } from '../../utils';\nimport { clearLinkButtonStyles } from '../Button';\nimport { DataLinksContextMenu } from '../DataLinks/DataLinksContextMenu';\n\nimport { CellActions } from './CellActions';\nimport { TableStyles } from './styles';\nimport { TableCellProps, CustomCellRendererProps, TableCellOptions } from './types';\nimport { getCellOptions } from './utils';\n\nexport const DefaultCell = (props: TableCellProps) => {\n  const { field, cell, tableStyles, row, cellProps, frame } = props;\n\n  const inspectEnabled = Boolean(field.config.custom?.inspect);\n  const displayValue = field.display!(cell.value);\n\n  const showFilters = props.onCellFilterAdded && field.config.filterable;\n  const showActions = (showFilters && cell.value !== undefined) || inspectEnabled;\n  const cellOptions = getCellOptions(field);\n  const hasLinks = Boolean(getCellLinks(field, row)?.length);\n  const clearButtonStyle = useStyles2(clearLinkButtonStyles);\n  const [hover, setHover] = useState(false);\n  let value: string | ReactElement;\n\n  const onMouseLeave = () => {\n    setHover(false);\n  };\n  const onMouseEnter = () => {\n    setHover(true);\n  };\n\n  if (cellOptions.type === TableCellDisplayMode.Custom) {\n    const CustomCellComponent: React.ComponentType<CustomCellRendererProps> = cellOptions.cellComponent;\n    value = <CustomCellComponent field={field} value={cell.value} rowIndex={row.index} frame={frame} />;\n  } else {\n    if (React.isValidElement(cell.value)) {\n      value = cell.value;\n    } else {\n      value = formattedValueToString(displayValue);\n    }\n  }\n\n  const isStringValue = typeof value === 'string';\n\n  const cellStyle = getCellStyle(tableStyles, cellOptions, displayValue, inspectEnabled, isStringValue);\n\n  if (isStringValue) {\n    let justifyContent = cellProps.style?.justifyContent;\n\n    if (justifyContent === 'flex-end') {\n      cellProps.style = { ...cellProps.style, textAlign: 'right' };\n    } else if (justifyContent === 'center') {\n      cellProps.style = { ...cellProps.style, textAlign: 'center' };\n    }\n  }\n\n  return (\n    <div\n      {...cellProps}\n      onMouseEnter={showActions ? onMouseEnter : undefined}\n      onMouseLeave={showActions ? onMouseLeave : undefined}\n      className={cellStyle}\n    >\n      {!hasLinks && (isStringValue ? `${value}` : <div className={tableStyles.cellText}>{value}</div>)}\n\n      {hasLinks && (\n        <DataLinksContextMenu links={() => getCellLinks(field, row) || []}>\n          {(api) => {\n            if (api.openMenu) {\n              return (\n                <button\n                  className={cx(clearButtonStyle, getLinkStyle(tableStyles, cellOptions, api.targetClassName))}\n                  onClick={api.openMenu}\n                >\n                  {value}\n                </button>\n              );\n            } else {\n              return <div className={getLinkStyle(tableStyles, cellOptions, api.targetClassName)}>{value}</div>;\n            }\n          }}\n        </DataLinksContextMenu>\n      )}\n\n      {hover && showActions && <CellActions {...props} previewMode=\"text\" showFilters={showFilters} />}\n    </div>\n  );\n};\n\nfunction getCellStyle(\n  tableStyles: TableStyles,\n  cellOptions: TableCellOptions,\n  displayValue: DisplayValue,\n  disableOverflowOnHover = false,\n  isStringValue = false\n) {\n  // How much to darken elements depends upon if we're in dark mode\n  const darkeningFactor = tableStyles.theme.isDark ? 1 : -0.7;\n\n  // Setup color variables\n  let textColor: string | undefined = undefined;\n  let bgColor: string | undefined = undefined;\n\n  if (cellOptions.type === TableCellDisplayMode.ColorText) {\n    textColor = displayValue.color;\n  } else if (cellOptions.type === TableCellDisplayMode.ColorBackground) {\n    const mode = cellOptions.mode ?? TableCellBackgroundDisplayMode.Gradient;\n\n    if (mode === TableCellBackgroundDisplayMode.Basic) {\n      textColor = getTextColorForAlphaBackground(displayValue.color!, tableStyles.theme.isDark);\n      bgColor = tinycolor(displayValue.color).toRgbString();\n    } else if (mode === TableCellBackgroundDisplayMode.Gradient) {\n      const bgColor2 = tinycolor(displayValue.color)\n        .darken(10 * darkeningFactor)\n        .spin(5);\n      textColor = getTextColorForAlphaBackground(displayValue.color!, tableStyles.theme.isDark);\n      bgColor = `linear-gradient(120deg, ${bgColor2.toRgbString()}, ${displayValue.color})`;\n    }\n  }\n\n  // If we have definied colors return those styles\n  // Otherwise we return default styles\n  if (textColor !== undefined || bgColor !== undefined) {\n    return tableStyles.buildCellContainerStyle(textColor, bgColor, !disableOverflowOnHover, isStringValue);\n  }\n\n  if (isStringValue) {\n    return disableOverflowOnHover ? tableStyles.cellContainerTextNoOverflow : tableStyles.cellContainerText;\n  } else {\n    return disableOverflowOnHover ? tableStyles.cellContainerNoOverflow : tableStyles.cellContainer;\n  }\n}\n\nfunction getLinkStyle(tableStyles: TableStyles, cellOptions: TableCellOptions, targetClassName: string | undefined) {\n  if (cellOptions.type === TableCellDisplayMode.Auto) {\n    return cx(tableStyles.cellLink, targetClassName);\n  }\n\n  return cx(tableStyles.cellLinkForColoredCell, targetClassName);\n}\n"],"names":["React"],"mappings":"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"}