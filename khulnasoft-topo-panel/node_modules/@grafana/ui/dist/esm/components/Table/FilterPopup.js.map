{"version":3,"file":"FilterPopup.js","sources":["../../../../src/components/Table/FilterPopup.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport { Field, GrafanaTheme2, SelectableValue } from '@grafana/data';\n\nimport { Button, ClickOutsideWrapper, HorizontalGroup, IconButton, Label, VerticalGroup } from '..';\nimport { useStyles2, useTheme2 } from '../../themes';\n\nimport { FilterList } from './FilterList';\nimport { TableStyles } from './styles';\nimport { calculateUniqueFieldValues, getFilteredOptions, valuesToOptions } from './utils';\n\ninterface Props {\n  column: any;\n  tableStyles: TableStyles;\n  onClose: () => void;\n  field?: Field;\n}\n\nexport const FilterPopup = ({ column: { preFilteredRows, filterValue, setFilter }, onClose, field }: Props) => {\n  const theme = useTheme2();\n  const uniqueValues = useMemo(() => calculateUniqueFieldValues(preFilteredRows, field), [preFilteredRows, field]);\n  const options = useMemo(() => valuesToOptions(uniqueValues), [uniqueValues]);\n  const filteredOptions = useMemo(() => getFilteredOptions(options, filterValue), [options, filterValue]);\n  const [values, setValues] = useState<SelectableValue[]>(filteredOptions);\n  const [matchCase, setMatchCase] = useState(false);\n\n  const onCancel = useCallback((event?: React.MouseEvent) => onClose(), [onClose]);\n\n  const onFilter = useCallback(\n    (event: React.MouseEvent) => {\n      const filtered = values.length ? values : undefined;\n\n      setFilter(filtered);\n      onClose();\n    },\n    [setFilter, values, onClose]\n  );\n\n  const onClearFilter = useCallback(\n    (event: React.MouseEvent) => {\n      setFilter(undefined);\n      onClose();\n    },\n    [setFilter, onClose]\n  );\n\n  const clearFilterVisible = useMemo(() => filterValue !== undefined, [filterValue]);\n  const styles = useStyles2(getStyles);\n\n  return (\n    <ClickOutsideWrapper onClick={onCancel} useCapture={true}>\n      {/* This is just blocking click events from bubbeling and should not have a keyboard interaction. */}\n      {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */}\n      <div className={cx(styles.filterContainer)} onClick={stopPropagation}>\n        <VerticalGroup spacing=\"lg\">\n          <VerticalGroup spacing=\"xs\">\n            <HorizontalGroup justify=\"space-between\" align=\"center\">\n              <Label className={styles.label}>Filter by values:</Label>\n              <IconButton\n                name=\"text-fields\"\n                tooltip=\"Match case\"\n                style={{ color: matchCase ? theme.colors.text.link : theme.colors.text.disabled }}\n                onClick={() => {\n                  setMatchCase((s) => !s);\n                }}\n              />\n            </HorizontalGroup>\n            <div className={cx(styles.listDivider)} />\n            <FilterList\n              onChange={setValues}\n              values={values}\n              options={options}\n              caseSensitive={matchCase}\n              showOperators={true}\n            />\n          </VerticalGroup>\n          <HorizontalGroup spacing=\"lg\">\n            <HorizontalGroup>\n              <Button size=\"sm\" onClick={onFilter}>\n                Ok\n              </Button>\n              <Button size=\"sm\" variant=\"secondary\" onClick={onCancel}>\n                Cancel\n              </Button>\n            </HorizontalGroup>\n            {clearFilterVisible && (\n              <HorizontalGroup>\n                <Button fill=\"text\" size=\"sm\" onClick={onClearFilter}>\n                  Clear filter\n                </Button>\n              </HorizontalGroup>\n            )}\n          </HorizontalGroup>\n        </VerticalGroup>\n      </div>\n    </ClickOutsideWrapper>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  filterContainer: css({\n    label: 'filterContainer',\n    width: '100%',\n    minWidth: '250px',\n    height: '100%',\n    maxHeight: '400px',\n    backgroundColor: theme.colors.background.primary,\n    border: `1px solid ${theme.colors.border.weak}`,\n    padding: theme.spacing(2),\n    margin: theme.spacing(1, 0),\n    boxShadow: theme.shadows.z3,\n    borderRadius: theme.shape.radius.default,\n  }),\n  listDivider: css({\n    label: 'listDivider',\n    width: '100%',\n    borderTop: `1px solid ${theme.colors.border.medium}`,\n    padding: theme.spacing(0.5, 2),\n  }),\n  label: css({\n    marginBottom: 0,\n  }),\n});\n\nconst stopPropagation = (event: React.MouseEvent) => {\n  event.stopPropagation();\n};\n"],"names":["React"],"mappings":"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"}