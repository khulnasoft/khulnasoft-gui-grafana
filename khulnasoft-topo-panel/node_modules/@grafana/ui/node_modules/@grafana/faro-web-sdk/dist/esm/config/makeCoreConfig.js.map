{"version":3,"file":"makeCoreConfig.js","sourceRoot":"","sources":["../../../src/config/makeCoreConfig.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,oBAAoB,EACpB,qBAAqB,EACrB,sBAAsB,EACtB,0BAA0B,EAC1B,wBAAwB,EACxB,uBAAuB,EACvB,QAAQ,GACT,MAAM,oBAAoB,CAAC;AAG5B,OAAO,EAAE,kBAAkB,EAAE,MAAM,WAAW,CAAC;AAC/C,OAAO,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AACtD,OAAO,EAAE,4BAA4B,EAAE,MAAM,6BAA6B,CAAC;AAC3E,OAAO,EAAE,YAAY,EAAE,eAAe,EAAE,MAAM,UAAU,CAAC;AACzD,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AACrC,OAAO,EAAE,cAAc,EAAE,MAAM,eAAe,CAAC;AAE/C,OAAO,EAAE,sBAAsB,EAAE,MAAM,0BAA0B,CAAC;AAGlE,MAAM,UAAU,cAAc,CAAC,aAA4B;;IACzD,MAAM,UAAU,GAAgB,EAAE,CAAC;IAEnC,MAAM,cAAc,GAAG,oBAAoB,CAAC,aAAa,CAAC,gBAAgB,EAAE,aAAa,CAAC,mBAAmB,CAAC,CAAC;IAE/G,IAAI,aAAa,CAAC,UAAU,EAAE;QAC5B,IAAI,aAAa,CAAC,GAAG,IAAI,aAAa,CAAC,MAAM,EAAE;YAC7C,cAAc,CAAC,KAAK,CAAC,sEAAsE,CAAC,CAAC;SAC9F;QAED,UAAU,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;KAC9C;SAAM,IAAI,aAAa,CAAC,GAAG,EAAE;QAC5B,UAAU,CAAC,IAAI,CACb,IAAI,cAAc,CAAC;YACjB,GAAG,EAAE,aAAa,CAAC,GAAG;YACtB,MAAM,EAAE,aAAa,CAAC,MAAM;SAC7B,CAAC,CACH,CAAC;KACH;SAAM;QACL,cAAc,CAAC,KAAK,CAAC,8CAA8C,CAAC,CAAC;KACtE;IAED,SAAS,WAAW;QAClB,MAAM,YAAY,GAAG,YAAY,CAAC;QAElC,IAAI,aAAa,CAAC,KAAK,EAAE;YACvB,YAAY,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,KAAK,CAAC,CAAC;SAC3C;QAED,MAAM,kBAAkB,GAAG,QAAQ,CAAE,MAAc,CAAC,EAAE,CAAC,CAAC;QAExD,IAAI,kBAAkB,EAAE;YACtB,OAAO,CAAC,GAAG,YAAY,EAAE,MAAM,CAAC,CAAC;SAClC;QAED,OAAO,YAAY,CAAC;IACtB,CAAC;IAED,MAAM,MAAM,GAAW;QACrB,GAAG,EAAE,aAAa,CAAC,GAAG;QACtB,QAAQ,kCACH,qBAAqB,GACrB,aAAa,CAAC,QAAQ,CAC1B;QACD,MAAM,EAAE,MAAA,aAAa,CAAC,MAAM,mCAAI,IAAI;QACpC,eAAe,EAAE,aAAa,CAAC,eAAe,IAAI,sBAAsB;QACxE,gBAAgB,EAAE,MAAA,aAAa,CAAC,gBAAgB,mCAAI,sBAAsB,EAAE;QAC5E,mBAAmB,EAAE,MAAA,aAAa,CAAC,mBAAmB,mCAAI,0BAA0B;QACpF,OAAO,EAAE,MAAA,aAAa,CAAC,OAAO,mCAAI,KAAK;QACvC,iBAAiB,EAAE,MAAA,aAAa,CAAC,iBAAiB,mCAAI,wBAAwB;QAC9E,KAAK,EAAE,WAAW,EAAE;QACpB,eAAe;QACf,MAAM,EAAE,MAAA,aAAa,CAAC,MAAM,mCAAI,KAAK;QACrC,qBAAqB,EAAE,MAAA,aAAa,CAAC,qBAAqB,mCAAI,KAAK;QACnE,UAAU;QACV,gBAAgB,EAAE,MAAA,aAAa,CAAC,gBAAgB,mCAAI,uBAAuB;QAE3E,UAAU,EAAE,aAAa,CAAC,UAAU;QACpC,WAAW,EAAE,MAAA,aAAa,CAAC,WAAW,mCAAI,kBAAkB;QAC5D,YAAY,EAAE,aAAa,CAAC,YAAY;QACxC,UAAU,EAAE,aAAa,CAAC,UAAU;QAEpC,eAAe,kCACV,4BAA4B,GAC5B,aAAa,CAAC,eAAe,CACjC;QAED,IAAI,EAAE,aAAa,CAAC,IAAI;QACxB,IAAI,EAAE,MAAA,aAAa,CAAC,IAAI,mCAAI,eAAe;QAC3C,cAAc,EAAE,aAAa,CAAC,cAAc;QAC5C,yBAAyB,EAAE,aAAa,CAAC,yBAAyB;KACnE,CAAC;IAEF,OAAO,MAAM,CAAC;AAChB,CAAC","sourcesContent":["import {\n  createInternalLogger,\n  defaultBatchingConfig,\n  defaultGlobalObjectKey,\n  defaultInternalLoggerLevel,\n  defaultLogArgsSerializer,\n  defaultUnpatchedConsole,\n  isObject,\n} from '@grafana/faro-core';\nimport type { Config, MetaItem, Transport } from '@grafana/faro-core';\n\nimport { defaultEventDomain } from '../consts';\nimport { parseStacktrace } from '../instrumentations';\nimport { defaultSessionTrackingConfig } from '../instrumentations/session';\nimport { defaultMetas, defaultViewMeta } from '../metas';\nimport { k6Meta } from '../metas/k6';\nimport { FetchTransport } from '../transports';\n\nimport { getWebInstrumentations } from './getWebInstrumentations';\nimport type { BrowserConfig } from './types';\n\nexport function makeCoreConfig(browserConfig: BrowserConfig): Config | undefined {\n  const transports: Transport[] = [];\n\n  const internalLogger = createInternalLogger(browserConfig.unpatchedConsole, browserConfig.internalLoggerLevel);\n\n  if (browserConfig.transports) {\n    if (browserConfig.url || browserConfig.apiKey) {\n      internalLogger.error('if \"transports\" is defined, \"url\" and \"apiKey\" should not be defined');\n    }\n\n    transports.push(...browserConfig.transports);\n  } else if (browserConfig.url) {\n    transports.push(\n      new FetchTransport({\n        url: browserConfig.url,\n        apiKey: browserConfig.apiKey,\n      })\n    );\n  } else {\n    internalLogger.error('either \"url\" or \"transports\" must be defined');\n  }\n\n  function createMetas(): MetaItem[] {\n    const initialMetas = defaultMetas;\n\n    if (browserConfig.metas) {\n      initialMetas.push(...browserConfig.metas);\n    }\n\n    const isK6BrowserSession = isObject((window as any).k6);\n\n    if (isK6BrowserSession) {\n      return [...initialMetas, k6Meta];\n    }\n\n    return initialMetas;\n  }\n\n  const config: Config = {\n    app: browserConfig.app,\n    batching: {\n      ...defaultBatchingConfig,\n      ...browserConfig.batching,\n    },\n    dedupe: browserConfig.dedupe ?? true,\n    globalObjectKey: browserConfig.globalObjectKey || defaultGlobalObjectKey,\n    instrumentations: browserConfig.instrumentations ?? getWebInstrumentations(),\n    internalLoggerLevel: browserConfig.internalLoggerLevel ?? defaultInternalLoggerLevel,\n    isolate: browserConfig.isolate ?? false,\n    logArgsSerializer: browserConfig.logArgsSerializer ?? defaultLogArgsSerializer,\n    metas: createMetas(),\n    parseStacktrace,\n    paused: browserConfig.paused ?? false,\n    preventGlobalExposure: browserConfig.preventGlobalExposure ?? false,\n    transports,\n    unpatchedConsole: browserConfig.unpatchedConsole ?? defaultUnpatchedConsole,\n\n    beforeSend: browserConfig.beforeSend,\n    eventDomain: browserConfig.eventDomain ?? defaultEventDomain,\n    ignoreErrors: browserConfig.ignoreErrors,\n    ignoreUrls: browserConfig.ignoreUrls,\n\n    sessionTracking: {\n      ...defaultSessionTrackingConfig,\n      ...browserConfig.sessionTracking,\n    },\n\n    user: browserConfig.user,\n    view: browserConfig.view ?? defaultViewMeta,\n    trackResources: browserConfig.trackResources,\n    trackWebVitalsAttribution: browserConfig.trackWebVitalsAttribution,\n  };\n\n  return config;\n}\n"]}